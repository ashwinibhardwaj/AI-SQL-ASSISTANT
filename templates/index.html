<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat with Your Data</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .fade-in { animation: fadeIn 0.4s ease-in-out; }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(5px);}
      to {opacity: 1; transform: translateY(0);}
    }
    .modal-bg { background: rgba(0,0,0,0.4); }

    /* Scrollbar styling */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 9999px; }

    .markdown-content h1, .markdown-content h2, .markdown-content h3 {
      font-weight: 600;
      margin-top: 0.75rem;
      margin-bottom: 0.5rem;
    }
    .markdown-content p { margin-bottom: 0.5rem; line-height: 1.6; }
    .markdown-content code {
      background-color: #f1f5f9;
      color: #0f172a;
      padding: 2px 4px;
      border-radius: 4px;
      font-family: ui-monospace, monospace;
    }
    .markdown-content pre {
      background-color: #f9fafb;
      color: #111827;
      border: 1px solid #e5e7eb;
      padding: 10px 14px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.9rem;
      margin-bottom: 0.75rem;
    }
    .markdown-content pre code {
      background: none;
      color: inherit;
      padding: 0;
    }
    .markdown-content table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.5rem;
      font-size: 0.875rem;
    }
    .markdown-content th, .markdown-content td {
      border: 1px solid #e2e8f0;
      padding: 6px 10px;
      text-align: left;
    }
    .markdown-content th {
      background-color: #f1f5f9;
      font-weight: 600;
    }
    .markdown-content ul, .markdown-content ol {
      margin-left: 1.2rem;
      margin-bottom: 0.5rem;
      list-style-type: disc;
    }
    #switchModal {
      transition: opacity 0.25s ease;
    }
    #switchModal.opacity-0 {
      opacity: 0;
    }
    #switchModal.opacity-100 {
      opacity: 1;
    }


    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn { animation: fadeIn 0.2s ease-out; }

    /* --- Resizable Data Preview Section --- */
#data-preview {
  height: 25vh; /* smaller default height */
  min-height: 120px; /* prevent collapsing */
  max-height: 70vh; /* prevent it from taking over the screen */
  resize: none; /* disable default corner resize */
  position: relative; /* needed for the top drag area */
  overflow: auto; /* allow scroll inside */
}

/* draggable top edge */
#data-preview::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 6px;
  cursor: ns-resize; /* resize cursor */
  background: transparent; /* invisible but clickable area */
  z-index: 10;
}

/* optional: subtle hover feedback for drag area */
#data-preview:hover::before {
  background: rgba(0, 0, 0, 0.05);
  transition: background 0.2s ease;
}

  </style>
</head>

<body class="flex h-screen bg-gray-50 text-gray-800 overflow-hidden">

  <!-- Sidebar -->
  <aside id="sidebar"
    class="fixed md:static top-0 left-0 h-full w-64 bg-white shadow-md flex flex-col border-r border-gray-200 z-40 
    transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out">
    <div class="p-4 border-b flex justify-between items-center">
      <h1 class="text-lg font-semibold">Datasets</h1>
      <button id="close-sidebar" class="md:hidden text-gray-500 hover:text-gray-700 text-2xl leading-none">&times;</button>
    </div>

    <div id="dataset-list" class="flex-1 overflow-y-auto p-4 space-y-4">
      <div>
        <h2 class="text-sm text-gray-500 uppercase mb-2">SQL Files</h2>
        <ul id="sql-files" class="space-y-1">
          {% for f in sql_files %}
            <li class="dataset-item flex justify-between items-center p-2 rounded-lg hover:bg-gray-100 transition">
              <span class="dataset-name cursor-pointer flex-1">{{ f }}</span>
              <button class="delete-btn text-red-500 hover:text-red-700 ml-3" title="Delete Dataset">üóëÔ∏è</button>
            </li>
          {% endfor %}
        </ul>

      </div>
    </div>

    <div class="p-4 border-t">
      <button id="open-upload-modal"
        class="w-full py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition">
        Upload Dataset
      </button>
    </div>
  </aside>

  <!-- Overlay for mobile sidebar -->
  <div id="sidebar-overlay"
    class="fixed inset-0 bg-black bg-opacity-40 hidden z-30 md:hidden transition-opacity duration-300 ease-in-out"></div>

  <!-- Main Content -->
  <main id="main-content" class="flex-1 flex flex-col h-full overflow-hidden relative">

    <!-- Mobile Sidebar Toggle Button -->
    <button id="open-sidebar"
      class="md:hidden absolute top-4 left-4 bg-white shadow-lg p-2 rounded-full border hover:bg-gray-100 transition z-20">
      üìÇ
    </button>

    <!-- Welcome Screen -->
    <div id="welcome-screen" class="flex flex-col items-center justify-center h-full text-center fade-in px-4">
      <h2 class="text-2xl font-semibold mb-2">Chat with Your Data</h2>
      <p class="text-gray-500">Select a dataset from the sidebar to start exploring.</p>
    </div>

    <!-- Chat Interface -->
    <div id="chat-interface" class="hidden flex flex-col h-full fade-in">
      <div class="flex justify-between items-center p-4 border-b bg-white shadow-sm">
        <h2 class="text-lg font-semibold text-gray-800" id="chat-title">Dataset Chat</h2>
      </div>

      <!--  Scrollable right section -->
      <div id="chat-messages" class="flex-1 overflow-y-auto p-4 bg-gray-50 space-y-4">
        <div class="text-gray-500 text-center mt-4">Start asking questions about your dataset...</div>
      </div>

      <!-- Data Preview Section -->
      <div id="data-preview" class="hidden border-t bg-white shadow-inner p-4 fade-in overflow-auto">
        <div class="flex justify-between items-center mb-3">
          <h3 class="text-md font-semibold text-gray-800">Data Preview</h3>
          <button id="close-preview" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
        </div>
        <div id="preview-table-container" class="overflow-x-auto"></div>
      </div>

      <div class="border-t bg-white p-4 flex gap-2 shadow-md sticky bottom-0">
        <input
          type="text"
          id="chat-input"
          placeholder="Ask a question..."
          class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
        />
        <button
          id="send-btn"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
        >Send</button>
      </div>
    </div>
  </main>

  <!-- Upload Modal -->
  <div id="upload-modal" class="hidden fixed inset-0 flex items-center justify-center modal-bg z-50">
    <div class="bg-white rounded-2xl shadow-2xl w-96 p-6 fade-in relative">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-800">Upload Dataset</h3>
        <button id="close-upload-modal" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
      </div>
      <form id="upload-form" action="{{ url_for('upload_file') }}" method="POST" enctype="multipart/form-data">
        <label for="file-upload" id="drop-area"
               class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition flex flex-col items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-blue-500 mb-2" fill="none"
               viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6.1a4.002 4.002 0 01-.9 7.9M15 13l-3-3m0 0l-3 3m3-3v12" />
          </svg>
          <p class="text-gray-600 text-sm mb-1">Drag & drop your file here</p>
          <p class="text-gray-400 text-xs">or click to browse</p>
          <input id="file-upload" type="file" name="file" accept=".sql" class="hidden" required />
        </label>
        <div id="file-info" class="text-sm text-gray-600 mt-3 hidden text-center"></div>
        <div class="flex justify-end gap-2 mt-6">
          <button type="button" id="cancel-upload"
                  class="px-4 py-2 border rounded-lg hover:bg-gray-100 transition">Cancel</button>
          <button type="submit"
                  class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition">Upload</button>
        </div>
      </form>
    </div>
  </div>

    <!-- Dataset Switch Confirmation Modal -->
<div id="switchModal" class="fixed inset-0 hidden bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 transition-opacity duration-300">
  <div class="relative bg-white dark:bg-gray-900 rounded-2xl shadow-2xl border border-gray-100 dark:border-gray-800 w-[90%] max-w-md mx-auto overflow-hidden transform transition-all duration-300 animate-fadeIn">
    
    <!-- Top Accent Line -->
    <div class="h-1.5 w-full bg-gradient-to-r from-blue-500 to-blue-700"></div>

    <!-- Modal Content -->
    <div class="p-8 text-center">
      <!-- Bright Warning Icon -->
      <div class="mx-auto mb-5 w-16 h-16 rounded-full flex items-center justify-center bg-amber-100 dark:bg-amber-900/30 shadow-inner">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-amber-500 dark:text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 9v3m0 4h.01M12 4a8 8 0 110 16a8 8 0 010-16z" />
        </svg>
      </div>

      <!-- Title -->
      <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-2">Switch Dataset?</h2>

      <!-- Description -->
      <p class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">
        Switching datasets will 
        <span class="font-medium text-blue-600 dark:text-blue-400">remove your current chat history</span> 
        and reset your conversation context.<br>Do you want to continue?
      </p>

      <!-- Buttons -->
      <div class="flex justify-center gap-4 mt-8">
        <button id="cancelSwitch"
          class="px-5 py-2.5 rounded-xl border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 font-medium shadow-sm">
          Cancel
        </button>
        
        <button id="confirmSwitch"
          class="px-5 py-2.5 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-semibold shadow-md hover:shadow-lg transition-all duration-200">
          Yes, Switch
        </button>
      </div>
    </div>
  </div>
</div>


<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 hidden bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 transition-opacity duration-300">
  <div class="relative bg-white rounded-2xl shadow-2xl border border-gray-100 w-[90%] max-w-md mx-auto overflow-hidden transform transition-all duration-300 animate-fadeIn">
    <div class="h-1.5 w-full bg-gradient-to-r from-red-500 to-red-700"></div>
    <div class="p-8 text-center">
      <div class="mx-auto mb-5 w-16 h-16 rounded-full flex items-center justify-center bg-red-100 shadow-inner">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 9v3m0 4h.01M12 4a8 8 0 110 16a8 8 0 010-16z" />
        </svg>
      </div>
      <h2 class="text-2xl font-semibold text-gray-800 mb-2">Delete Dataset?</h2>
      <p id="deleteText" class="text-gray-600 text-sm">
        Are you sure you want to delete this dataset? This will permanently remove the file and its database.
      </p>
      <div class="flex justify-center gap-4 mt-8">
        <button id="cancelDelete"
          class="px-5 py-2.5 rounded-xl border border-gray-300 text-gray-700 bg-gray-50 hover:bg-gray-100 transition-all duration-200 font-medium shadow-sm">
          Cancel
        </button>
        <button id="confirmDelete"
          class="px-5 py-2.5 rounded-xl bg-red-600 hover:bg-red-700 text-white font-semibold shadow-md transition-all duration-200">
          Yes, Delete
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div id="toast"
  class="fixed bottom-6 right-6 hidden bg-green-600 text-white text-sm font-medium px-5 py-3 rounded-xl shadow-lg transition-all duration-300 transform translate-y-4 opacity-0">
</div>




  <!-- Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  let currentDataset = null;
  const uploadModal = document.getElementById("upload-modal");
  const openUploadModal = document.getElementById("open-upload-modal");
  const closeUploadModal = document.getElementById("close-upload-modal");
  const cancelUpload = document.getElementById("cancel-upload");
  const fileUpload = document.getElementById("file-upload");
  const fileInfo = document.getElementById("file-info");

  openUploadModal.addEventListener("click", () => uploadModal.classList.remove("hidden"));
  const closeModal = () => uploadModal.classList.add("hidden");
  closeUploadModal.addEventListener("click", closeModal);
  cancelUpload.addEventListener("click", closeModal);
  uploadModal.addEventListener("click", (e) => { if (e.target === uploadModal) closeModal(); });

  fileUpload.addEventListener("change", (e) => {
    const file = e.target.files[0];
    fileInfo.textContent = file ? `üìÅ Selected: ${file.name}` : "";
    fileInfo.classList.toggle("hidden", !file);
  });

  const sidebar = document.getElementById("sidebar");
  const openSidebar = document.getElementById("open-sidebar");
  const closeSidebar = document.getElementById("close-sidebar");
  const overlay = document.getElementById("sidebar-overlay");
  const dataPreview = document.getElementById("data-preview");
  const previewContainer = document.getElementById("preview-table-container");
  const closePreview = document.getElementById("close-preview");

  const chatInterface = document.getElementById("chat-interface");
  const welcomeScreen = document.getElementById("welcome-screen");
  const chatInput = document.getElementById("chat-input");
  const sendBtn = document.getElementById("send-btn");
  const chatMessages = document.getElementById("chat-messages");
  const chatTitle = document.getElementById("chat-title");

  const switchModal = document.getElementById("switchModal");
  const cancelSwitch = document.getElementById("cancelSwitch");
  const confirmSwitch = document.getElementById("confirmSwitch");
  const switchText = switchModal.querySelector("p"); // get modal text
  let pendingDataset = null;

  const datasetItems = document.querySelectorAll(".dataset-item");

  function hideSidebar() {
    sidebar.classList.add("-translate-x-full");
    overlay.classList.add("hidden");
  }

  openSidebar.addEventListener("click", () => {
    sidebar.classList.remove("-translate-x-full");
    overlay.classList.remove("hidden");
  });
  overlay.addEventListener("click", hideSidebar);
  closeSidebar.addEventListener("click", hideSidebar);

  // Custom dataset switching with warning message
  datasetItems.forEach(item => {
    item.addEventListener("click", async () => {
      const selectedName = item.querySelector(".dataset-name")?.textContent.trim() || item.textContent.trim();
      const currentDataset = chatTitle.textContent.replace("Chat: ", "").trim();

      if (selectedName === currentDataset) return;

      const hasMessages = [...chatMessages.children].some(
        msg => !msg.textContent.includes("Start asking questions")
      );

      if (hasMessages) {
        pendingDataset = selectedName;
        switchText.innerHTML = `
          You are about to switch to <strong>${selectedName}</strong>.<br><br>
          Your current chat history and context will be <strong class="text-red-600">cleared</strong> permanently.<br>
          Do you want to continue?
        `;
        showSwitchModal();
        return;
      }
      await switchDataset(selectedName);
    });
  });

  function showSwitchModal() {
    switchModal.classList.remove("hidden");
    switchModal.classList.add("flex");
    requestAnimationFrame(() => switchModal.classList.add("opacity-100"));
  }

  function hideSwitchModal() {
    switchModal.classList.remove("opacity-100");
    setTimeout(() => {
      switchModal.classList.add("hidden");
      switchModal.classList.remove("flex");
    }, 200);
  }

  cancelSwitch.addEventListener("click", () => {
    hideSwitchModal();
    pendingDataset = null;
  });

  confirmSwitch.addEventListener("click", async () => {
    hideSwitchModal();
    if (pendingDataset) {
      await switchDataset(pendingDataset);
      pendingDataset = null;
    }
  });

  async function switchDataset(selectedName) {
    document.querySelectorAll(".dataset-item").forEach(i =>
      i.classList.remove("bg-blue-100", "text-blue-700")
    );
    const selectedItem = [...datasetItems].find(i => i.textContent.trim() === selectedName);
    selectedItem?.classList.add("bg-blue-100", "text-blue-700");

    chatMessages.innerHTML = `<div class="text-gray-500 text-center mt-4">
      Start asking questions about your dataset...
    </div>`;
    dataPreview.classList.add("hidden");

    welcomeScreen.classList.add("hidden");
    chatInterface.classList.remove("hidden", "fade-in");
    void chatInterface.offsetWidth;
    chatInterface.classList.add("fade-in");
    chatTitle.textContent = `Chat: ${selectedName}`;
    currentDataset = selectedName;

    hideSidebar();

    try {
      const res = await fetch("/load_schema", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ filename: selectedName }),
      });
      const data = await res.json();
      console.log("Schema loaded:", data.schema);
    } catch (err) {
      console.error("Error loading schema:", err);
    }
  }

  sendBtn.addEventListener("click", sendMessage);
  chatInput.addEventListener("keypress", (e) => { if (e.key === "Enter") sendMessage(); });

  async function sendMessage() {
    const text = chatInput.value.trim();
    if (!text) return;

    const userMsg = document.createElement("div");
    userMsg.className = "self-end bg-blue-600 text-white px-4 py-2 rounded-xl max-w-sm ml-auto fade-in shadow";
    userMsg.textContent = text;
    chatMessages.appendChild(userMsg);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    chatInput.value = "";

    const loadingMsg = document.createElement("div");
    loadingMsg.className = "self-start bg-gray-100 text-gray-500 px-4 py-2 rounded-xl max-w-sm fade-in shadow";
    loadingMsg.textContent = "Thinking...";
    chatMessages.appendChild(loadingMsg);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    try {
      const res = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          query: text,
          filename: currentDataset
        })
      });

      const data = await res.json();

      loadingMsg.remove();

      const botMsg = document.createElement("div");
      botMsg.className = "self-start bg-gray-100 text-gray-800 px-4 py-2 rounded-xl max-w-3xl fade-in shadow markdown-content prose";
      
      if (data.error) {
        botMsg.innerHTML = `<span class="text-red-600">${data.error}</span>`;
      } else if (data.answer) {
        botMsg.innerHTML = marked.parse(data.answer);
      } else if (data.response) {
        botMsg.innerHTML = marked.parse(data.response);
      } else {
        botMsg.textContent = "No response from agent.";
      }

      chatMessages.appendChild(botMsg);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      hljs.highlightAll();

      if (data.result && Array.isArray(data.result) && data.result.length > 0) {
        renderPreviewTable(data.result);
        dataPreview.classList.remove("hidden");
      } else {
        dataPreview.classList.add("hidden");
      }
    } catch (err) {
      console.error("Error:", err);
      loadingMsg.remove();
      const errorMsg = document.createElement("div");
      errorMsg.className = "self-start bg-red-100 text-red-700 px-4 py-2 rounded-xl max-w-sm fade-in shadow";
      errorMsg.textContent = "Error: Unable to get response.";
      chatMessages.appendChild(errorMsg);
    }
  }

  function renderPreviewTable(data) {
    if (!data || data.length === 0) return;
    const columns = Object.keys(data[0]);
    const table = document.createElement("table");
    table.className = "min-w-full border-collapse text-sm";
    const thead = document.createElement("thead");
    thead.innerHTML = `<tr>${columns.map(col => `<th class='border px-3 py-1 bg-gray-100 text-left font-semibold'>${col}</th>`).join("")}</tr>`;
    const tbody = document.createElement("tbody");
    tbody.innerHTML = data.map(row =>
      `<tr>${columns.map(col =>
        `<td class='border px-3 py-1'>${row[col] ?? ""}</td>`
      ).join("")}</tr>`
    ).join("");
    table.appendChild(thead);
    table.appendChild(tbody);
    previewContainer.innerHTML = "";
    previewContainer.appendChild(table);
  }

  closePreview.addEventListener("click", () => dataPreview.classList.add("hidden"));

  const previewSection = document.getElementById("data-preview");
  let isResizing = false, startY = 0, startHeight = 0;
  previewSection.addEventListener("mousedown", (e) => {
    if (e.offsetY < 8) {
      isResizing = true;
      startY = e.clientY;
      startHeight = previewSection.offsetHeight;
      document.body.style.cursor = "ns-resize";
      e.preventDefault();
    }
  });
  document.addEventListener("mousemove", (e) => {
    if (!isResizing) return;
    const dy = startY - e.clientY;
    let newHeight = startHeight + dy;
    newHeight = Math.max(120, Math.min(window.innerHeight * 0.7, newHeight));
    previewSection.style.height = `${newHeight}px`;
  });
  document.addEventListener("mouseup", () => {
    if (isResizing) {
      isResizing = false;
      document.body.style.cursor = "";
    }
  });

  // ===== DELETE DATASET FEATURE =====
const deleteModal = document.getElementById("deleteModal");
const deleteText = document.getElementById("deleteText");
const cancelDelete = document.getElementById("cancelDelete");
const confirmDelete = document.getElementById("confirmDelete");
let datasetToDelete = null;

// Attach delete button handlers
document.querySelectorAll(".delete-btn").forEach(btn => {
  btn.addEventListener("click", (e) => {
    e.stopPropagation(); // prevent triggering dataset switch
    const datasetName = btn.closest(".dataset-item").querySelector(".dataset-name").textContent.trim();
    datasetToDelete = datasetName;
    deleteText.innerHTML = `Are you sure you want to delete <strong>${datasetName}</strong>?<br>This will permanently remove the file and its database.`;
    showDeleteModal();
  });
});

function showDeleteModal() {
  deleteModal.classList.remove("hidden");
  requestAnimationFrame(() => deleteModal.classList.add("opacity-100"));
}

function hideDeleteModal() {
  deleteModal.classList.remove("opacity-100");
  setTimeout(() => deleteModal.classList.add("hidden"), 200);
}

cancelDelete.addEventListener("click", hideDeleteModal);

confirmDelete.addEventListener("click", async () => {
  if (!datasetToDelete) return;
  try {
    const res = await fetch("/delete_dataset", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ filename: datasetToDelete })
    });
    const data = await res.json();
    console.log("Delete response:", data);
    showToast(data.message || "Deleted successfully.", "success");
    hideDeleteModal();
    setTimeout(() => location.reload(), 1500);
  } catch (err) {
    console.error("Error deleting:", err);
    showToast("Error deleting dataset.", "error");
  }
});


// ===== TOAST NOTIFICATION SYSTEM =====
function showToast(message, type = "success") {
  let toast = document.getElementById("toast");
  if (!toast) {
    toast = document.createElement("div");
    toast.id = "toast";
    document.body.appendChild(toast);
  }

  toast.textContent = message;
  toast.className = `
    fixed bottom-6 right-6 px-5 py-3 rounded-xl text-white text-sm font-medium shadow-lg
    transition-all duration-300 transform opacity-0 translate-y-4
    ${type === "error" ? "bg-red-600" : "bg-green-600"}
  `;

  // Show animation
  requestAnimationFrame(() => {
    toast.classList.remove("opacity-0", "translate-y-4");
    toast.classList.add("opacity-100", "translate-y-0");
  });

  // Hide after 3 seconds
  setTimeout(() => {
    toast.classList.remove("opacity-100", "translate-y-0");
    toast.classList.add("opacity-0", "translate-y-4");
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}

});
</script>

</body>
</html>
